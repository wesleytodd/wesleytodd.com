<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Drag n&#x27; Drop In Raphael.js</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="/css/global.css">
        <script src="/js/vendor/modernizr.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

		<header id="navigation">
			<a href="#navigation" class="open"></a>
			<nav id="page-nav">
				<h1 id="page-logo"><a href="/">Wesley Todd - Home</a></h1>
				<ul><li><a href="/index.html">Home</a></li><li><a href="/resume.html">Resume</a></li></ul>

				<h3>Articles</h2>
				<ul><li><a href="/2013/4/drag-n-drop-in-raphael-js.html">Drag n' Drop In Raphael.js</a></li><li><a href="/2011/5/html5-login.html">HTML5 Login</a></li><li><a href="/2013/4/html5-node-csv.html">HTML5 + Node CSV Viewer</a></li></ul>
			</nav>

			<div id="page-foot">
				<div id="social-nav">
					<ul>
						<li class="social-icon github"><a href="https://github.com/wesleytodd">GitHub</a></li>
						<li class="social-icon wordpress"><a href="http://profiles.wordpress.org/jawesomeclay">WordPress</a></li>
						<li class="social-icon email"><a href="mailto:wes@wesleytodd.com">Email</a></li>
						<li class="social-icon facebook"><a href="http://www.facebook.com/johnwesleytodd">Facebook</a></li>
					</ul>
				</div>
				<span id="site-by" href="http://wesleytodd.com" title="Designed, Developed &amp; Written by Wes Todd">Designed, Developed &amp; Written by Wes Todd</span>
			</div>
		</header>

		<div id="page-content">
			<header id="content-header">
				<small class="date">4.18.2013</small>
				<h1>Drag n&#x27; Drop In Raphael.js</h1>
			</header>
			<section class="section">
				<p><pre class="codepen" data-height="300" data-type="result" data-href="akrqJ" data-user="wesleytodd" data-safe="true"><code></code><a href="http://codepen.io/wesleytodd/pen/akrqJ">Check out this Pen!</a></pre></p>
<script async src="http://codepen.io/assets/embed/ei.js"></script>

<p>In this example, I am going to work through a simple method of implementing a drag and drop interaction for element sets in Raphael.js.  Raphael inclued a method for dragging a single element, but when you want to drag a set you are <abbr title="Shit Out Of Luck">sol</abbr>.  There are really no good examples if you google around.  So lets work through it.</p>
<p>We want to add a function that will be on every new set we create, that can be called to make the set draggable.  To make a function avaliable to all the sets we create, we need to add a function to the set prototype, but if you try and add it the &#39;normal&#39; way, <code>Raphael.set.prototype</code>, you will see that it doesnt exist.  Actually, it is hidden inside the Raphael closure, so to access a set&#39;s prototype you need to add the method to <code>Raphael.st</code>:</p>
<pre><code class="lang-javascript">Raphael.st.draggable = function() {

};</code></pre>
<p>Inside this function we are going to build logic for moving the set around the paper. To get started lets create a few variables we will need, and create the event handlers we will need:</p>
<pre><code class="lang-javascript">Raphael.st.draggable = function() {
    var me = this,
        lx = 0,
        ly = 0,
        ox = 0,
        oy = 0,
        moveFnc = function(dx, dy) {},
        startFnc = function() {},
        endFnc = function() {};

    this.drag(moveFnc, startFnc, endFnc);
};</code></pre>
<p>We need a reference to the set, <code>me</code>, for use inside the drag functions.  This is needed because Raphael will only register the drag event on an individual element, but we need to make sure all elements move together.  We are also going to be using a few x and y values to keep track of where our elements are currently (<code>lx</code>, <code>ly</code>), and where they came from at the start of the drag (<code>ox</code>, <code>oy</code>).  Lastly, we have stubbed out the event handlers and bound them to the mouse events using Raphael&#39;s <code>drag</code> function.  Raphael will loop through all the elements in the set and attach the three event handlers.</p>
<p>Raphael registers a callback on mousedown (drag start), mouseup (drag end) and mousemove (drag move), each of which gets passed into the drag function respectively.  When an event is triggered on a single element, our <code>draggable</code> function still has a reference to the whole set, <code>me</code>, and so can transform all the elements together.  To get started with the event handlers, lets go over the drag start function.  This doesn&#39;t do much...er, anything:</p>
<pre><code class="lang-javascript">startFnc = function() {},</code></pre>
<p>Because we have instantiated the starting transformation values to 0 we don&#39;t need to do anything on drag start.  Ok, <em>moving</em> on...the move function is the most important.  The move function gets passed the difference in x and y coordinates from the beginning of this drag (<code>dx</code>, <code>dy</code>).  These are added to the original values and then used to transform the elements.</p>
<pre><code class="lang-javascript">moveFnc = function(dx, dy) {
    lx = dx + ox;  // add the new change in x to the drag origin
    ly = dy + oy;  // do the same for y
    me.transform(&#39;t&#39; + lx + &#39;,&#39; + ly);
}</code></pre>
<p>Remember, we get passed in the change in x and y from the start position of this drag interaction.  We add the original x and y values, both zero on the first drag, to the new changes, then transform the set by the new values.  The transform is represented by the string <code>tx,y</code>, <code>t</code> meaning transform.  So we just build that string and pass it in to Raphael&#39;s <code>transform</code> method.  The <code>ly</code> and <code>lx</code> values are saved so that we can store the last value as the new original transform in the end function:</p>
<pre><code class="lang-javascript">endFnc = function() {
    ox = lx;
    oy = ly;
}</code></pre>
<p>By saving the last transform values we ensure that the next drag preserves all previous changes.  Otherwise the set would transform right back to their original place when the new drag starts.  You can check that out if you want by editing the CodePen.</p>
<p>To put it all together we get:</p>
<pre><code class="lang-javascript">Raphael.st.draggable = function() {
  var me = this,
      lx = 0,
      ly = 0,
      ox = 0,
      oy = 0,
      moveFnc = function(dx, dy) {
          lx = dx + ox;
          ly = dy + oy;
          me.transform(&#39;t&#39; + lx + &#39;,&#39; + ly);
      },
      startFnc = function() {},
      endFnc = function() {
          ox = lx;
          oy = ly;
      };

  this.drag(moveFnc, startFnc, endFnc);
};</code></pre>
<p>Now all we have to do is setup a canvas and add a few elements to a set:</p>
<pre><code class="lang-javascript">var paper = Raphael(document.getElementById(&#39;canvas&#39;));
var mySet = paper.set();

mySet.push(paper.circle(550, 150, 50).attr(&#39;fill&#39;, &#39;red&#39;));
mySet.push(paper.circle(550, 150, 40).attr(&#39;fill&#39;, &#39;white&#39;));
mySet.push(paper.circle(550, 150, 30).attr(&#39;fill&#39;, &#39;red&#39;));
mySet.push(paper.circle(550, 150, 20).attr(&#39;fill&#39;, &#39;white&#39;));
mySet.push(paper.circle(550, 150, 10).attr(&#39;fill&#39;, &#39;red&#39;));</code></pre>
<p>As you can see in the example at the top, the set is transformed along with your mouse as you drag it.  And even better, Raphael.js also enables touch events so that this interactions works on tablets and phones!  It even works in older IE&#39;s because of the built in VML conversion, how awesome is that?</p>

			</section>
		</div>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/js/vendor/jquery/jquery.js"><\/script>')</script>
        <script src="/js/global.js"></script>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
            var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
    </body>
</html>
