<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>WP 3.1 Admin Bar: Removal, Styling and Frustration</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="/css/global.css">
        <script src="/js/vendor/modernizr.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

		<header id="navigation">
			<a href="#navigation" class="open"></a>
			<nav id="page-nav">
				<h1 id="page-logo"><a href="/">Wesley Todd - Home</a></h1>
				<ul><li><a href="/index.html">Home</a></li><li><a href="/resume.html">Resume</a></li></ul>

				<h3>Articles</h2>
				<ul><li><a href="/2013/4/drag-n-drop-in-raphael-js.html">Drag n' Drop In Raphael.js</a></li><li><a href="/2011/5/html5-login.html">HTML5 Login</a></li><li><a href="/2011/2/wp31-admin-bar-removal-styling.html">WP 3.1 Admin Bar: Removal, Styling and Frustration</a></li></ul>
			</nav>

			<div id="page-foot">
				<div id="social-nav">
					<ul>
						<li class="social-icon github"><a href="https://github.com/wesleytodd">GitHub</a></li>
						<li class="social-icon wordpress"><a href="http://profiles.wordpress.org/jawesomeclay">WordPress</a></li>
						<li class="social-icon email"><a href="mailto:wes@wesleytodd.com">Email</a></li>
						<li class="social-icon facebook"><a href="http://www.facebook.com/johnwesleytodd">Facebook</a></li>
					</ul>
				</div>
				<span id="site-by" href="http://wesleytodd.com" title="Designed, Developed &amp; Written by Wes Todd">Designed, Developed &amp; Written by Wes Todd</span>
			</div>
		</header>

		<div id="page-content">
			<header id="content-header">
				<small class="date">2.24.2011</small>
				<h1>WP 3.1 Admin Bar: Removal, Styling and Frustration</h1>
			</header>
			<section class="section">
				<blockquote>
<p>UPDATE: I made a plugin that is really simple and handles all the stuff in this article and more: <a href="http://wordpress.org/extend/plugins/wp-custom-admin-bar/">WP Custom Admin Bar</a></p>
</blockquote>
<p>A new version of WordPress! Yeah! I hit update and after everything goes smoothly I figure I am good to go.  I load up the home page and what do I see?  Everything got bumped down the page by 28px. Eexcept for the absolutely positioned elements, which stayed in place, messing up the whole layout.  All because this new gray bar on the top of the page.</p>
<p>As I am sure most of us did, I installed the new version before reading about what was included.  Had I done some research before I updated, I would have known that the admin bar from the BuddyPress plugin was being added.  This is a great feature for site admins and bloggers to eaisly access the back-end features of WordPress. It only shows for logged in users and contains some quick links to the admin section which are really handy.</p>
<p>Unfortunately, it can also have some nasty side effects for the layout.  What did it effect? Direct child elements of the body which are absolutely positioned:</p>
<pre><code class="lang-html">&lt;body&gt;
    &lt;div style=&quot;position:absolute;&quot;&gt;
        &lt;p&gt;Lorizzle phat dizzle sit amizzle, brizzle adipiscing elit.&lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;</code></pre>
<p>The site I updated has a section for logged in users which shows information about their account.  They are subscribers (user level) and have no ability to edit anything other than their profile.  Do they need an admin bar? No, so I want to get rid of it.  Google it and I&#39;m sure you will find the same articles about disabling it site wide:</p>
<pre><code class="lang-php">//in functions.php
add_filter(&#39;show_admin_bar&#39;,&#39;__return_false&#39;);</code></pre>
<p>Great, no more admin bar!  But wait, I want the admin bar for me, just not for my subscribers.  Ok, some quick detection of the current users level and we can add the removal filter for just subscribers:</p>
<pre><code class="lang-php">//if the current user is a subscriber, turn off the admin bar
if ( current_user_can( &#39;subscriber&#39; ) ) {
    add_filter(&#39;show_admin_bar&#39;,&#39;__return_false&#39;);
}</code></pre>
<p>We have our admin bar hidden for our subscribers and showing for all others, but we are still stuck with the layout problems that are caused by the 28px bump.  Take a look in Firebug (or your inspector of choice) and you can see that a style is added with a margin-top of 28px, and its &quot;!important&quot;.  We can over rule this with our css if we want:</p>
<pre><code class="lang-css">//wherever you put your css...`//wherever you put your css...
html { margin-top: 0 !important; }
* html body { margin-top: 0 !important; }</code></pre>
<p>But why have the extra code on your page?  We should be able to get rid of it before the page is sent using some php.  Usually, things that are added in the header and generated by  WordPress are added using a hook into the wp_head action.  I figured that if I could find the call back function that adds the style tag I could just call the remove_action function on it and bye bye bump!  Found it and tried the remove_action function, but it just wouldn&#39;t go away.  Great WordPress, you add some code to my page without giving me a normal way to remove it!</p>
<p>It turns out that when the admin bar is initialized, it calls a default callback function to add the style tag.  But this will be overridden if a new callback function is given.  You have to re-add theme support for the admin bar with the optional callback function declared:</p>
<pre><code class="lang-php">//functions.php
add_theme_support( &#39;admin-bar&#39;, array( &#39;callback&#39; =&gt; &#39;my_adminbar_cb&#39;) );
function my_adminbar_cb(){
    //empty function
}</code></pre>
<p>This new function is called instead of the default which add the style tags with the margin.  So In my case, I just left the function blank so nothing would be output.  This could also be used add your own custom styling for the admin bar:</p>
<pre><code>//functions.php
add_theme_support( &#39;admin-bar&#39;, array( &#39;callback&#39; =&gt; &#39;my_adminbar_cb&#39;) );
function my_adminbar_cb(){
    echo &#39;&lt;style&gt;#adminbar {bottom: 0 !important;}&lt;/style&gt;&#39;;
}</code></pre>
<p>If there is anything else you might be wondering about as far as the admin bar goes, here are the WorePress core files for reference:</p>
<ul>
<li><a href="http://core.trac.wordpress.org/browser/tags/3.1/wp-includes/admin-bar.php">wp-includes/admin-bar.php</a></li>
<li><a href="http://core.trac.wordpress.org/browser/tags/3.1/wp-includes/class-wp-admin-bar.php">wp-includes/class-wp-admin-bar.php</a></li>
</ul>

			</section>
		</div>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/js/vendor/jquery/jquery.js"><\/script>')</script>
        <script src="/js/global.js"></script>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
            var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
    </body>
</html>
